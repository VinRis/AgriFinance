{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account within the AgriFinance Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user, used for login.",
          "format": "email"
        },
        "farmName": {
          "type": "string",
          "description": "The name of the farm associated with the user."
        },
        "managerName": {
          "type": "string",
          "description": "The name of the farm manager."
        },
        "location": {
          "type": "string",
          "description": "The location of the farm."
        },
        "currency": {
          "type": "string",
          "description": "The currency used for financial records."
        },
        "darkMode": {
          "type": "boolean",
          "description": "Preference for dark mode display."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "LivestockRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LivestockRecord",
      "type": "object",
      "description": "Represents a financial record associated with livestock, such as dairy or poultry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the livestock record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who created the record. (Relationship: User 1:N LivestockRecord)"
        },
        "livestockType": {
          "type": "string",
          "description": "The type of livestock this record pertains to (e.g., Dairy, Poultry)."
        },
        "date": {
          "type": "string",
          "description": "The date of the record.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A brief description of the record."
        },
        "amount": {
          "type": "number",
          "description": "The financial amount associated with the record."
        }
      },
      "required": [
        "id",
        "userId",
        "livestockType",
        "date",
        "amount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership allows easy enforcement of user-specific data access using request.auth.uid.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/livestockRecords/{livestockRecordId}",
        "definition": {
          "entityName": "LivestockRecord",
          "schema": {
            "$ref": "#/backend/entities/LivestockRecord"
          },
          "description": "Stores livestock records associated with a specific user.  The `userId` field ensures that each record is owned by the user identified in the path. Path-based ownership enables simple and secure `list` operations (QAPs) and prevents unauthorized data access. Enforces ownership invariants via the `userId` field.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns the livestock record."
            },
            {
              "name": "livestockRecordId",
              "description": "The unique identifier for the livestock record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to securely manage user data and livestock records while ensuring authorization independence and efficient querying. We leverage path-based ownership for user-specific data, storing LivestockRecords as subcollections under each user's document. This structure naturally enforces security rules based on `request.auth.uid` without requiring complex `get()` calls. Each document's `userId` field enforces ownership invariants. The `users/{userId}/livestockRecords/{livestockRecordId}` path-based approach supports secure list operations (QAPs) as the rules only need to check `request.auth.uid == userId` to allow listing of records. This design promotes clarity, debuggability, and scalable security."
  }
}